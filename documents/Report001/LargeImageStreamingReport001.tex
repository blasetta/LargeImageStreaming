\documentclass{InsightArticle}

\usepackage[dvips]{graphicx}
\usepackage{color}
\usepackage{listings}

\definecolor{listcomment}{rgb}{0.0,0.5,0.0}
\definecolor{listkeyword}{rgb}{0.0,0.0,0.5}
\definecolor{listnumbers}{gray}{0.65}
\definecolor{listlightgray}{gray}{0.955}
\definecolor{listwhite}{gray}{1.0}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  hyperref should be the last package to be loaded.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[dvips,
bookmarks,
bookmarksopen,
backref,
colorlinks,linkcolor={blue},citecolor={blue},urlcolor={blue},
]{hyperref}


\title{Large Image Streaming using ITKv4}


%
% NOTE: This is the last number of the "handle" URL that
% The Insight Journal assigns to your paper as part of the
% submission process. Please replace the number "1338" with
% the actual handle number that you get assigned.
%
\newcommand{\IJhandlerIDnumber}{3063}

\lstset{frame = tb,
       framerule = 0.25pt,
       float,
       fontadjust,
       backgroundcolor={\color{listlightgray}},
       basicstyle = {\ttfamily\footnotesize},
       keywordstyle = {\ttfamily\color{listkeyword}\textbf},
       identifierstyle = {\ttfamily},
       commentstyle = {\ttfamily\color{listcomment}\textit},
       stringstyle = {\ttfamily},
       showstringspaces = false,
       showtabs = false,
       numbers = left,
       numbersep = 6pt,
       numberstyle={\ttfamily\color{listnumbers}},
       tabsize = 2,
       language=[ANSI]C++,
       floatplacement=!h
       }

\release{1.10}

\author{Maria Alejandra Zuluaga$^{1}$, Luis Ib\'{a}\~{n}ez$^{2}$, Fran\c{c}oise Peyrin$^{1}$}
\authoraddress{$^{1}$Creatis, Lyon, France\\
               $^{2}$Kitware Inc., Clifton Park, NY}

\begin{document}


%
% Add hyperlink to the web location and license of the paper.
% The argument of this command is the handler identifier given
% by the Insight Journal to this paper.
%
\IJhandlefooter{\IJhandlerIDnumber}


\ifpdf
\else
   %
   % Commands for including Graphics when using latex
   %
   \DeclareGraphicsExtensions{.eps,.jpg,.gif,.tiff,.bmp,.png}
   \DeclareGraphicsRule{.jpg}{eps}{.jpg.bb}{`convert #1 eps:-}
   \DeclareGraphicsRule{.gif}{eps}{.gif.bb}{`convert #1 eps:-}
   \DeclareGraphicsRule{.tiff}{eps}{.tiff.bb}{`convert #1 eps:-}
   \DeclareGraphicsRule{.bmp}{eps}{.bmp.bb}{`convert #1 eps:-}
   \DeclareGraphicsRule{.png}{eps}{.png.bb}{`convert #1 eps:-}
\fi


\maketitle


\ifhtml
\chapter*{Front Matter\label{front}}
\fi


\begin{abstract}
\noindent
This document illustrates how to process large images (about 10 Gigabytes in
size) by taking advantage of the streaming capabilities of the Insight Toolkit
ITK.  Here we illustrate two scenarios: (a) the case when the image itself is
larger than the computer's RAM, (b) the case when the image is large but still
can fit in the computer's RAM. This report is intended to serve as a tutorial
on how to take advantage of this memory management capabilities of ITK.

This paper is accompanied with the source code, input data, parameters and
output data that we used for validating the algorithm described in this paper.
This adheres to the fundamental principle that scientific publications must
facilitate \textbf{reproducibility} of the reported results.
\end{abstract}

\tableofcontents

\section{Introduction}

Large images are becoming ubiquitus in many research fields. They are
particularly common in microscopy, remote sensing and computer vision.  Image
sizes are growing at a higher rate than the size of computer memory and
therefore there is a great interest in software method that allow to process
images by partitioning in pieces that can temporarily be fit into memory.

In this technical report we illustrate how this can be done with the current
infrastructure of the Insight Toolkit (ITK).

\section{Reading and Writing}

In this section we illustrate the simple case in which a large image is read
from a given input file and then it is writen into another file.

\begin{center}
\lstinputlisting[linerange={21-24}]{../../src/ImageReadStreamWrite.cxx}
\end{center}

Figure~\ref{fig:OriginalImage} presents the original image.

\begin{figure}
\center
\includegraphics[width=0.7\textwidth]{../../Testing/Temporary/ReadWriteTest_huc01resa_Slice.png}
\itkcaption[Original Image]{Middle slice from the original image.}
\label{fig:OriginalImage}
\end{figure}



\section{Binary Thresholding}

\begin{center}
\lstinputlisting[linerange={21-24}]{../../src/BinaryThresholdImageFilter.cxx}
\end{center}

Figure~\ref{fig:BinaryImage} presents the binary image.

\begin{figure}
\center
\includegraphics[width=0.7\textwidth]{../../Testing/Temporary/BinaryThresholdTest_huc01resa_Slice.png}
\itkcaption[Binary Image]{Middle slice from the binary image.}
\label{fig:BinaryImage}
\end{figure}



\section{Eliminating Islands}

\begin{center}
\lstinputlisting[linerange={21-24}]{../../src/VotingBinaryHoleFillingImageFilter.cxx}
\end{center}

Figure~\ref{fig:IslandRemovalImage} presents the image after island removal.

\begin{figure}
\center
\includegraphics[width=0.7\textwidth]{../../Testing/Temporary/VotingHoleFillingTest_01_huc01resa_Slice.png}
\itkcaption[Island Removal Image]{Middle slice from the image after island removal.}
\label{fig:IslandRemovalImage}
\end{figure}


\section{Filling-Up Holes}

\begin{center}
\lstinputlisting[linerange={21-24}]{../../src/VotingBinaryHoleFillingImageFilter.cxx}
\end{center}


\subsection{One Iteration}

Figure~\ref{fig:HoleFillingIteration01Image} presents the image after one iteration of hole filling.

\begin{figure}
\center
\includegraphics[width=0.7\textwidth]{../../Testing/Temporary/VotingHoleFillingTest_02_huc01resa_Slice.png}
\itkcaption[Hole Filling 1 Iteration]{Middle slice from the image after one iteration of hole filling.}
\label{fig:HoleFillingIteration01Image}
\end{figure}



\subsection{Two Iterations}

Figure~\ref{fig:HoleFillingIteration02Image} presents the image after two iteration of hole filling.

\begin{figure}
\center
\includegraphics[width=0.7\textwidth]{../../Testing/Temporary/VotingHoleFillingTest_03_huc01resa_Slice.png}
\itkcaption[Hole Filling 2 Iterations]{Middle slice from the image after two iteration of hole filling.}
\label{fig:HoleFillingIteration02Image}
\end{figure}



\subsection{Three Iterations}

Figure~\ref{fig:HoleFillingIteration03Image} presents the image after three iteration of hole filling.

\begin{figure}
\center
\includegraphics[width=0.7\textwidth]{../../Testing/Temporary/VotingHoleFillingTest_04_huc01resa_Slice.png}
\itkcaption[Hole Filling 3 Iterations]{Middle slice from the image after three iteration of hole filling.}
\label{fig:HoleFillingIteration03Image}
\end{figure}



\subsection{Subtraction}

Figure~\ref{fig:SubtractionImage} presents the difference between the image
after three iteration of hole filling and the image after islan removal. This
is an initial detector of osteoclasts cavities.

\begin{figure}
\center
\includegraphics[width=0.7\textwidth]{../../Testing/Temporary/SubtractImageTest_huc01resa_Slice.png}
\itkcaption[Subtraction]{Middle slice from the subtraction image.}
\label{fig:SubtractionImage}
\end{figure}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  Insert the bibliography using BibTeX
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibliographystyle{plain}
\bibliography{InsightJournal}


\end{document}
